import{H as Gt}from"../chunks/BUApaBEI.js";import{s as Kt,g as Zt}from"../chunks/D8SgZ4jZ.js";import{b as Ht,d as te,a as P,f as H,c as ee}from"../chunks/CXw8tMbP.js";import{t as w,h as W,v as jt,b1 as re,a as Et,W as se,ac as ne,a_ as ie,aX as oe,y as ae,a0 as st,Q as le,aq as ot,ar as at,j as T,i as b,A as ce,as as D,aw as X,D as de,u as ue,F as z,au as ge,k as t,b2 as he,$ as me,b0 as _,aO as pe}from"../chunks/BU4Rvi8u.js";import{i as I,_ as fe}from"../chunks/D7KWC1rY.js";import{o as ve}from"../chunks/CRRAUqjJ.js";import{s as _t}from"../chunks/DFHL0JgO.js";import{h as ye,a as $,e as gt}from"../chunks/DCKIY628.js";import{p as L,b as kt}from"../chunks/C81_f7je.js";import{b as nt}from"../chunks/6z85Luv5.js";import{r as _e}from"../chunks/8J8Sa0vB.js";function xt(r,o,i=!1,a=!1,c=!1){var u=r,x="";w(()=>{var v=le;if(x===(x=o()??"")){W&&jt();return}if(v.nodes!==null&&(re(v.nodes.start,v.nodes.end),v.nodes=null),x!==""){if(W){Et.data;for(var p=jt(),h=p;p!==null&&(p.nodeType!==se||p.data!=="");)h=p,p=ne(p);if(p===null)throw ie(),oe;Ht(Et,h),u=ae(p);return}var f=x+"";i?f=`<svg>${f}</svg>`:a&&(f=`<math>${f}</math>`);var A=te(f);if((i||a)&&(A=st(A)),Ht(st(A),A.lastChild),i||a)for(;st(A);)u.before(st(A));else u.before(A)}})}function xe(r,o,i){var a=r==null?"":""+r;return a=a?a+" "+o:o,a===""?null:a}function we(r,o){return r==null?null:String(r)}function be(r,o,i,a,c,u){var x=r.__className;if(W||x!==i||x===void 0){var v=xe(i,a);(!W||v!==r.getAttribute("class"))&&(v==null?r.removeAttribute("class"):r.className=v),r.__className=i}return u}function ft(r,o,i,a){var c=r.__style;if(W||c!==o){var u=we(o);(!W||u!==r.getAttribute("style"))&&(u==null?r.removeAttribute("style"):r.style.cssText=u),r.__style=o}return a}function $e(r,o){throw new Gt(r,o)}const Ae=!0,Te=()=>Kt.map(r=>({slug:r.slug})),Se=({params:r})=>{const o=Zt(r.slug);if(!o)throw $e(404,`Story "${r.slug}" not found.`);return{story:o}},dr=Object.freeze(Object.defineProperty({__proto__:null,entries:Te,load:Se,prerender:Ae},Symbol.toStringTag,{value:"Module"})),vt=r=>typeof r=="string"?r.trim():"",Nt=r=>r.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;"),Pe=r=>vt(vt(r).replace(/\r\n?/g,`
`)),Me=r=>{const o=vt(r);return/^(https?:|mailto:|tel:)/i.test(o)?o.replaceAll('"',"%22"):""},Y=r=>{const o=[],i=r.replace(/`([^`]+)`/g,(c,u)=>{const x=`@@CODE_${o.length}@@`;return o.push(`<code>${Nt(u)}</code>`),x});let a=Nt(i);return a=a.replace(/\[([^\]]+)\]\(([^)\s]+)\)/g,(c,u,x)=>{const v=Me(x);return v?`<a href="${v}" target="_blank" rel="noopener noreferrer">${u}</a>`:u}),a=a.replace(/\*\*([^*\n]+)\*\*/g,"<strong>$1</strong>"),a=a.replace(/\*([^*\n]+)\*/g,"<em>$1</em>"),a=a.replace(/~~([^~\n]+)~~/g,"<s>$1</s>"),o.forEach((c,u)=>{a=a.replaceAll(`@@CODE_${u}@@`,c)}),a},Ft=r=>r.trim().length===0,zt=r=>/^\s*(-{3,}|\*{3,}|_{3,})\s*$/.test(r),He=r=>/^\s{0,3}#{1,4}\s+/.test(r),ht=r=>/^\s{0,3}[-*+]\s+/.test(r),mt=r=>/^\s{0,3}\d+\.\s+/.test(r),pt=r=>/^\s{0,3}>\s?/.test(r),je=r=>{const o=Pe(r);if(o.length===0)return"";const i=o.split(`
`),a=[];let c=0;for(;c<i.length;){const u=i[c];if(Ft(u)){c+=1;continue}if(zt(u)){a.push("<hr>"),c+=1;continue}const x=u.match(/^\s{0,3}(#{1,4})\s+(.+)$/);if(x){const h=x[1].length;a.push(`<h${h}>${Y(x[2].trim())}</h${h}>`),c+=1;continue}if(ht(u)){const h=[];for(;c<i.length&&ht(i[c]);){const f=i[c].replace(/^\s{0,3}[-*+]\s+/,"");h.push(`<li>${Y(f.trim())}</li>`),c+=1}a.push(`<ul>${h.join("")}</ul>`);continue}if(mt(u)){const h=[];for(;c<i.length&&mt(i[c]);){const f=i[c].replace(/^\s{0,3}\d+\.\s+/,"");h.push(`<li>${Y(f.trim())}</li>`),c+=1}a.push(`<ol>${h.join("")}</ol>`);continue}if(pt(u)){const h=[];for(;c<i.length&&pt(i[c]);)h.push(i[c].replace(/^\s{0,3}>\s?/,"")),c+=1;const f=h.map(A=>Y(A)).join("<br>");a.push(`<blockquote><p>${f}</p></blockquote>`);continue}const v=[];for(;c<i.length&&!Ft(i[c]);){const h=i[c];if(v.length>0&&(zt(h)||He(h)||ht(h)||mt(h)||pt(h)))break;v.push(h),c+=1}const p=v.map(h=>Y(h.trim())).join("<br>");a.push(`<p>${p}</p>`)}return a.join(`
`)},yt=r=>je(r);var Ee=H('<section class="relative z-20 px-1 pb-10 pt-2"><div class="max-w-4xl"><div class="story-richtext text-sm text-[var(--story-text)]"><!></div></div></section>');function ke(r,o){at(o,!0);let i=L(o,"credits",3,null);var a=Ee(),c=T(a),u=T(c),x=T(u);xt(x,()=>{var v;return yt(((v=i())==null?void 0:v.label)??"")}),b(u),b(c),b(a),P(r,a),ot()}var Ne=H('<div class="mt-4 story-richtext max-w-3xl text-base leading-relaxed"><!></div>'),Fe=H('<section class="relative z-20 px-2 pt-1 mb-10"><div class="max-w-xl"><h2 class="text-3xl leading-tight tracking-tight"> </h2> <!></div></section>');function ze(r,o){let i=L(o,"title",3,""),a=L(o,"introVisible",3,!1),c=L(o,"introHtml",3,"");var u=ee(),x=ce(u);{var v=p=>{var h=Fe(),f=T(h),A=T(f),q=T(A,!0);b(A);var J=D(A,2);{var Q=M=>{var S=Ne(),O=T(S);xt(O,c),b(S),P(M,S)};I(J,M=>{a()&&M(Q)})}b(f),b(h),w(()=>_t(q,i())),P(p,h)};I(x,p=>{i()&&p(v)})}P(r,u)}var Le=H('<h3 class="text-2xl font-normal leading-tight tracking-tight text-[var(--story-context-text)]"> </h3>'),Oe=H('<div class="story-richtext scene-context-copy text-base leading-tight text-[var(--story-context-muted)] svelte-1kzmjux"><!></div>'),Re=H('<article><div class="bg-[var(--story-context-bg)] text-[var(--story-context-text)] p-2"><!> <!></div></article>'),Ce=H('<section class="flex items-center py-2"><!></section>');function Ie(r,o){at(o,!0);let i=L(o,"moment",3,null),a=L(o,"active",3,!1),c=L(o,"heightVh",3,92);var u=Ce(),x=T(u);{var v=p=>{var h=Re(),f=T(h),A=T(f);{var q=M=>{var S=Le(),O=T(S,!0);b(S),w(()=>_t(O,i().title)),P(M,S)};I(A,M=>{i().title&&M(q)})}var J=D(A,2);{var Q=M=>{var S=Oe(),O=T(S);xt(O,()=>i().html),b(S),P(M,S)};I(J,M=>{i().html&&M(Q)})}b(f),b(h),w(()=>be(h,1,`w-fit max-w-xl transition-opacity duration-300 ${a()?"opacity-100":"opacity-82"}`,"svelte-1kzmjux")),P(p,h)};I(x,p=>{var h;(h=i())!=null&&h.hasContent&&p(v)})}b(u),w(()=>ft(u,`min-height:${c()}dvh`)),P(r,u),ot()}const Ve={},Be=/^(https?:|data:|blob:|\/\/|file:)/i,De=r=>typeof r=="string"?r.trim():"",it=(r,o="")=>{const i=De(r);if(i.length===0||Be.test(i)||o&&(i===o||i.startsWith(`${o}/`)))return i;if(i.startsWith("/"))return`${o}${i}`;const a=i.replace(/^\.\//,"");return`${o}/${a}`},Lt=(r,o="")=>Array.isArray(r)?r.map(i=>({...i,src:it(i.src,o),previewSrc:it(i.previewSrc,o)})):[],We=r=>!!(r&&typeof r=="object"&&Array.isArray(r.projections)),qe=async(r,o=fetch)=>{const i=typeof r=="string"?r.trim():"";if(i.length===0)return null;const a=await o(i,{cache:"no-store"});if(!a.ok)throw new Error(`Failed to load ${i}: ${a.status}`);const c=await a.json();if(!We(c))throw new Error(`Invalid story JSON at ${i}`);return c};var Je=H('<div class="mono absolute inset-0 z-20 grid place-items-center text-xs uppercase tracking-[0.2em] text-[var(--story-muted-text)]"> </div>'),Qe=H("<vantage-keyframe></vantage-keyframe>",2),Ue=H("<vantage-projection></vantage-projection>",2),Xe=H("<div></div>"),Ye=H('<section class="min-h-[100dvh]"></section>'),Ge=H('<main class="relative bg-[var(--story-page-bg)] text-[var(--story-text)]"><div><!></div> <section class="relative"><div class="sticky top-0 h-[100dvh] overflow-hidden bg-[var(--story-scene-bg)]"><!> <vantage-renderer></vantage-renderer></div> <div class="relative z-20 -mt-[100dvh]"><!> <section class="h-[20dvh]"></section></div></section> <!></main>',2);function Ke(r,o){at(o,!0);let i=L(o,"storyPath",3,""),a=X(de(Ve)),c=_(()=>_e(t(a))),u=_(()=>t(c).ui),x=_(()=>t(c).sceneSrc),v=_(()=>Array.isArray(t(c).projections)?t(c).projections:[]),p=_(()=>t(c).cameraPathProjection),h=_(()=>{var e;return((e=t(p))==null?void 0:e.id)??""}),f=_(()=>t(c).cameraPathRange??{start:0,end:1,duration:1}),A=_(()=>Array.isArray(t(c).narrativeMoments)?t(c).narrativeMoments:[]),q=_(()=>it(i(),nt)),J=_(()=>it(t(x),nt)),Q=_(()=>Lt(t(v),nt)),M=_(()=>t(p)?t(v).some(s=>s.id===t(p).id)?[]:Lt([t(p)],nt):[]),S=_(()=>[...t(Q),...t(M)]),O=_(()=>{var s;if(t(h).length>0)return t(h);const e=t(S).find(n=>n.projectionType==="perspective");return(e==null?void 0:e.id)??((s=t(S)[0])==null?void 0:s.id)??""}),lt=X(!1),G=X(0),ct=X(0),j,K=X(null),V=0;const Z=e=>typeof e=="string"?e.trim():"",R=e=>e==null?void 0:String(e),C=(e,s,n)=>Math.min(n,Math.max(s,e)),wt=(e,s=0)=>{const n=Number(e);return Number.isFinite(n)&&n>0?n:s};let E=_(()=>t(u).theme??{}),bt=_(()=>{var d;const e=Array.isArray((d=t(p))==null?void 0:d.keyframes)?[...t(p).keyframes].map(l=>({time:Number(l==null?void 0:l.time),scrollWeight:wt(l==null?void 0:l.scrollWeight,1),pause:wt(l==null?void 0:l.pause,0)})).filter(l=>Number.isFinite(l.time)).sort((l,m)=>l.time-m.time):[];if(e.length===0)return[{progress:0,time:t(f).start},{progress:1,time:t(f).end}];if(e.length===1)return[{progress:0,time:e[0].time},{progress:1,time:e[0].time}];const s=[{weight:0,time:e[0].time}];let n=0;for(let l=0;l<e.length;l+=1){const m=e[l];m.pause>0&&(n+=m.pause,s.push({weight:n,time:m.time}));const y=e[l+1];y&&(n+=m.scrollWeight,s.push({weight:n,time:y.time}))}if(n<=1e-6)return[{progress:0,time:e[0].time},{progress:1,time:e[e.length-1].time}];const g=s.map(l=>({progress:l.weight/n,time:l.time}));return g[0].progress=0,g[g.length-1].progress=1,g});const $t=e=>{const s=t(bt);if(!Array.isArray(s)||s.length===0)return t(f).start+C(e,0,1)*t(f).duration;const n=C(e,0,1);if(n<=s[0].progress)return s[0].time;if(n>=s[s.length-1].progress)return s[s.length-1].time;for(let g=0;g<s.length-1;g+=1){const d=s[g],l=s[g+1];if(n>=d.progress&&n<=l.progress){const m=Math.max(1e-6,l.progress-d.progress),y=(n-d.progress)/m;return d.time+y*(l.time-d.time)}}return s[s.length-1].time},Ot=e=>{const s=t(bt),n=Number(e);if(!Number.isFinite(n))return 0;if(!Array.isArray(s)||s.length===0)return C((n-t(f).start)/t(f).duration,0,1);if(n<=s[0].time)return s[0].progress;if(n>=s[s.length-1].time)return s[s.length-1].progress;for(let g=0;g<s.length-1;g+=1){const d=s[g],l=s[g+1],m=Math.min(d.time,l.time),y=Math.max(d.time,l.time);if(n<m||n>y)continue;if(Math.abs(l.time-d.time)<=1e-6)return d.progress;const F=(n-d.time)/(l.time-d.time);return C(d.progress+F*(l.progress-d.progress),0,1)}return s[s.length-1].progress};let At=_(()=>{var s,n,g,d;const e=Z((n=(s=t(u))==null?void 0:s.context)==null?void 0:n.introText);return e.length>0?e:Z((d=(g=t(u))==null?void 0:g.header)==null?void 0:d.description)}),Rt=_(()=>yt(t(At))),Ct=_(()=>t(At).length>0),It=_(()=>t(A).map((e,s)=>{var m,y;const n=Z((m=e==null?void 0:e.context)==null?void 0:m.title),g=Z((y=e==null?void 0:e.context)==null?void 0:y.markdown),d=g.length>0?yt(g):"",l=n.length>0||d.length>0;return{id:(e==null?void 0:e.id)??`moment-${s+1}`,time:Number(e==null?void 0:e.time)||0,progress:Ot(Number(e==null?void 0:e.time)),title:n,html:d,hasContent:l}})),k=_(()=>[...t(It)].sort((e,s)=>{const n=e.progress-s.progress;return Math.abs(n)>1e-6?n:e.time-s.time})),Tt=_(()=>{if(t(k).length===0)return[];if(t(k).length===1)return[{moment:t(k)[0],heightVh:120}];const e=560,s=t(k).map(g=>C(g.progress,0,1)),n=[0];for(let g=1;g<s.length;g+=1)n.push((s[g-1]+s[g])/2);return n.push(1),t(k).map((g,d)=>{const l=Math.max(.03,n[d+1]-n[d]);return{moment:g,heightVh:Math.max(44,l*e)}})}),Vt=_(()=>{if(t(k).length===0)return"";let e=t(k)[0];for(const s of t(k))if(s.progress<=t(ct)+1e-6)e=s;else break;return e.id});const Bt=async()=>{const e=await qe(t(q));e&&z(a,e,!0)},Dt=e=>{if(!t(K)||t(k).length===0)return null;const n=Array.from(t(K).children).filter(y=>y instanceof HTMLElement).map((y,F)=>{const B=t(k)[F];if(!B)return null;const rt=y.getBoundingClientRect();return{center:window.scrollY+rt.top+rt.height*.5,progress:B.progress}}).filter(Boolean),g=(j==null?void 0:j.offsetTop)??0,d=g+window.innerHeight*.5,l=g+((j==null?void 0:j.offsetHeight)??window.innerHeight)-window.innerHeight*.5,m=[{center:d,progress:0},...n,{center:Math.max(d+1,l),progress:1}];if(m.length<=1)return null;for(let y=1;y<m.length;y+=1)m[y].center<=m[y-1].center&&(m[y].center=m[y-1].center+1);if(e<=m[0].center)return m[0].progress;if(e>=m[m.length-1].center)return m[m.length-1].progress;for(let y=0;y<m.length-1;y+=1){const F=m[y],B=m[y+1];if(e>=F.center&&e<=B.center){const rt=Math.max(1e-6,B.center-F.center),Yt=(e-F.center)/rt;return F.progress+Yt*(B.progress-F.progress)}}return m[0].progress},St=()=>{if(typeof window>"u")return;const e=window.scrollY+window.innerHeight*.5,s=Dt(e);if(s!=null){const m=C(s,0,1);z(ct,m,!0),z(G,$t(m),!0);return}if(!j)return;const n=j.offsetTop,g=Math.max(1,j.offsetHeight-window.innerHeight),d=(window.scrollY-n)/g,l=C(d,0,1);z(ct,l,!0),z(G,$t(l),!0)},U=()=>{V||typeof window>"u"||(V=requestAnimationFrame(()=>{V=0,St()}))};ve(async()=>{try{await Bt()}catch(e){console.warn("[story] Falling back to bundled story data.",e)}return await fe(()=>import("../chunks/ChAUp7cn.js"),[],import.meta.url),z(lt,!0),await ge(),St(),window.addEventListener("scroll",U,{passive:!0}),window.addEventListener("resize",U,{passive:!0}),()=>{V&&(cancelAnimationFrame(V),V=0),window.removeEventListener("scroll",U),window.removeEventListener("resize",U)}}),ue(()=>{if(t(f),!t(lt)){z(G,t(f).start,!0);return}U()});var tt=Ge();ye("18hak38",e=>{he(()=>{me.title=t(u).pageTitle??""})});var dt=T(tt),Wt=T(dt);ze(Wt,{get title(){return t(u).header.title},get introVisible(){return t(Ct)},get introHtml(){return t(Rt)}}),b(dt);var et=D(dt,2),ut=T(et),Pt=T(ut);{var qt=e=>{var s=Je(),n=T(s,!0);b(s),w(()=>_t(n,t(u).renderer.loading)),P(e,s)};I(Pt,e=>{t(lt)||e(qt)})}var N=D(Pt,2);w(()=>$(N,"scene",t(J))),$(N,"controls","false"),$(N,"first-person","false"),$(N,"follow-focus","true"),$(N,"show-camera-frame","false"),w(()=>$(N,"background-color",t(E).sceneBg)),ft(N,"display:block;height:100%;width:100%;pointer-events:none;touch-action:none"),w(()=>$(N,"time",t(G).toFixed(4))),gt(N,21,()=>t(S),e=>e.id,(e,s)=>{var n=Ue();w(()=>$(n,"id",t(s).id)),w(()=>$(n,"src",t(s).src)),w(()=>$(n,"projection-type",t(s).projectionType)),w(()=>$(n,"time",R(t(s).time))),w(()=>$(n,"focus",t(s).id===t(O)?"true":"false")),gt(n,23,()=>t(s).keyframes,(g,d)=>`${t(s).id}-${d}`,(g,d)=>{var l=Qe();w(()=>$(l,"time",R(t(d).time))),w(()=>$(l,"position",R(t(d).position))),w(()=>$(l,"rotation",R(t(d).rotation))),w(()=>$(l,"fov",R(t(d).fov))),w(()=>$(l,"far",R(t(d).far))),w(()=>$(l,"opacity",R(t(d).opacity))),w(()=>$(l,"screen",t(d).screen===!0?"":void 0)),P(g,l)}),b(n),P(e,n)}),b(N),b(ut);var Mt=D(ut,2),Jt=T(Mt);{var Qt=e=>{var s=Xe();gt(s,21,()=>t(Tt),n=>n.moment.id,(n,g)=>{{let d=_(()=>t(g).moment.id===t(Vt));Ie(n,{get moment(){return t(g).moment},get active(){return t(d)},get heightVh(){return t(g).heightVh}})}}),b(s),kt(s,n=>z(K,n),()=>t(K)),P(e,s)},Ut=e=>{var s=Ye();P(e,s)};I(Jt,e=>{t(Tt).length>0?e(Qt):e(Ut,!1)})}pe(2),b(Mt),b(et),kt(et,e=>j=e,()=>j);var Xt=D(et,2);ke(Xt,{get credits(){return t(u).credits}}),b(tt),w(()=>ft(tt,`--story-page-bg:${t(E).pageBg};--story-scene-bg:${t(E).sceneBg};--story-panel-fill:${t(E).panelFill};--story-panel-stroke:${t(E).panelStroke};--story-text:${t(E).text};--story-muted-text:${t(E).mutedText};--story-accent:${t(E).accent};--story-context-bg:${t(E).contextBg};--story-context-text:${t(E).contextText};--story-context-muted:${t(E).contextMuted};`)),P(r,tt),ot()}function ur(r,o){at(o,!0),Ke(r,{get storyPath(){return o.data.story.storyPath}}),ot()}export{ur as component,dr as universal};
