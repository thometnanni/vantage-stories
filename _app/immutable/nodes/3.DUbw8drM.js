import{i as D,_ as at}from"../chunks/D7KWC1rY.js";import{a as $,f as L}from"../chunks/CXw8tMbP.js";import{at as ot,o as nt,f as O,B as st,au as it,h as lt,av as ct,aw as P,D as we,F as n,t as z,aq as dt,ar as ut,k as a,g as pt,$ as ft,as as f,j as m,i as v,ax as _e,A as ke}from"../chunks/BU4Rvi8u.js";import{d as vt,s as j}from"../chunks/DFHL0JgO.js";import{h as bt,r as mt,e as ht}from"../chunks/DCKIY628.js";import{r as gt}from"../chunks/CrnG9bKD.js";function ae(t,i,h=i){var s=new WeakSet;ot(t,"input",async x=>{var l=x?t.defaultValue:t.value;if(l=oe(t)?ne(l):l,h(l),O!==null&&s.add(O),await it(),l!==(l=i())){var u=t.selectionStart,c=t.selectionEnd,k=t.value.length;if(t.value=l??"",c!==null){var S=t.value.length;u===c&&c===k&&S>k?(t.selectionStart=S,t.selectionEnd=S):(t.selectionStart=u,t.selectionEnd=Math.min(c,S))}}}),(lt&&t.defaultValue!==t.value||nt(i)==null&&t.value)&&(h(oe(t)?ne(t.value):t.value),O!==null&&s.add(O)),st(()=>{var x=i();if(t===document.activeElement){var l=ct??O;if(s.has(l))return}oe(t)&&x===ne(t.value)||t.type==="date"&&!x&&!t.value||x!==t.value&&(t.value=x??"")})}function oe(t){var i=t.type;return i==="number"||i==="range"}function ne(t){return t===""?null:+t}const xt=!0,Ct=Object.freeze(Object.defineProperty({__proto__:null,prerender:xt},Symbol.toStringTag,{value:"Module"})),I=(t,i)=>{const h=Number(t);return Number.isFinite(h)?h:i},C=(t,i=!1)=>{if(t===!0)return!0;if(t===!1||t==null)return i;if(typeof t=="string"){if(t==="false"||t==="0")return!1;if(t==="true"||t==="1"||t==="")return!0}return i},A=t=>typeof t!="string"?"":t.trim(),Se=(t,i="")=>{const h=A(t.getAttribute("context-markdown"))||A(t.getAttribute("context")),s=A(t.getAttribute("context-title")),x=h||A(t.getAttribute("context-text"))||A(i);if(!(s.length===0&&x.length===0))return{...s.length>0?{title:s}:{},...x.length>0?{markdown:x}:{}}},yt=t=>{const i=t.cloneNode(!0);return i.querySelectorAll("vantage-keyframe").forEach(h=>h.remove()),i.textContent??""},se=t=>{const i=A(t);if(i.length===0||/^(https?:|data:|blob:|\/\/|file:)/i.test(i))return null;const l=i.split("#")[0].split("?")[0].replace(/\\+/g,"/").replace(/^\.\//,"").replace(/^\/+/,"");return l.length>0?l:null},wt=t=>{const i=Array.from(t.querySelectorAll("vantage-projection")).filter(s=>s.parentElement===t);let h=0;return i.map(s=>{h+=1;const x=A(s.getAttribute("projection-type"))||"perspective",l=Array.from(s.querySelectorAll("vantage-keyframe")).filter(b=>b.parentElement===s).map(b=>{const y={time:I(b.getAttribute("time"),0)};for(const w of["position","rotation","layers","bounds"]){const g=A(b.getAttribute(w));g.length>0&&(y[w]=g)}for(const w of["fov","far","opacity"]){const g=b.getAttribute(w);g!=null&&g!==""&&(y[w]=I(g,void 0))}b.hasAttribute("screen")&&(y.screen=C(b.getAttribute("screen"),!0));const F=Se(b,b.textContent??"");return F!=null&&(y.context=F),y}),u={id:A(s.getAttribute("id"))||`projection-${h}`,src:A(s.getAttribute("src")),projectionType:x,time:I(s.getAttribute("time"),0),cameraSelectable:s.hasAttribute("camera-selectable")?C(s.getAttribute("camera-selectable"),!0):x!=="map",keyframes:l};s.hasAttribute("focus")&&(u.focus=C(s.getAttribute("focus"),!0)),s.hasAttribute("camera-path")&&(u.cameraPath=C(s.getAttribute("camera-path"),!0));const c=A(s.getAttribute("label"));c.length>0&&(u.label=c);const k=A(s.getAttribute("preview-src"));k.length>0&&(u.previewSrc=k),s.hasAttribute("start-time")&&(u.startTime=I(s.getAttribute("start-time"),u.time));const S=Se(s,yt(s));return S!=null&&(u.context=S),u})},_t=t=>{const i=t.querySelector("vantage-renderer");if(i)return{renderer:i,sceneSrc:A(i.getAttribute("scene"))||""};if(!t.querySelector("vantage-projection"))throw new Error("No <vantage-renderer> or <vantage-projection> found in the pasted HTML.");return{renderer:t.body,sceneSrc:""}},kt=t=>{if(typeof DOMParser>"u")throw new Error("DOMParser is not available in this environment.");const i=A(t);if(i.length===0)throw new Error("Paste the <vantage-renderer> block first.");const s=new DOMParser().parseFromString(i,"text/html"),{renderer:x,sceneSrc:l}=_t(s),u=s.querySelector("input#time"),c={sceneSrc:l,maxTimelineTime:I(u==null?void 0:u.getAttribute("max"),void 0),projections:wt(x)},k=c.projections.find(w=>w.focus===!0&&w.projectionType==="perspective");k&&(c.cameraPathProjectionId=k.id);const S=gt(c),b={sceneSrc:S.sceneSrc,maxTimelineTime:S.maxTimelineTime,...c.cameraPathProjectionId?{cameraPathProjectionId:c.cameraPathProjectionId}:{},ui:S.ui,projections:S.projections},y=new Set,F=se(b.sceneSrc);F&&y.add(F);for(const w of b.projections){const g=se(w.src);g&&y.add(g);const R=se(w.previewSrc);R&&y.add(R)}return{story:b,stats:{projections:b.projections.length,keyframes:b.projections.reduce((w,g)=>w+g.keyframes.length,0)},assetPaths:Array.from(y)}},Pe=t=>{const i=A(t).replace(/\\+/g,"/").replace(/^\/+/,"");return i.length===0?"":i.split("/").filter(Boolean).at(-1)??""},ie=(t,i)=>{const h=Array.isArray(i)?i:[];if(h.length===0)return{total:t.length,checked:0,found:[],missing:[]};const s=new Set;for(const u of h){const c=typeof u.webkitRelativePath=="string"&&u.webkitRelativePath.length>0?u.webkitRelativePath:u.name,k=Pe(c);k.length>0&&s.add(k)}const x=[],l=[];for(const u of t){const c=Pe(u);s.has(c)?x.push(u):l.push(u)}return{total:t.length,checked:h.length,found:x,missing:l}};var St=L('<p class="mt-2 rounded-[var(--radius-button)] border border-red-200 bg-red-50 px-2 py-1 text-xs text-red-700"> </p>'),Pt=L("<p> </p> <p> </p>",1),At=L("<p>No data yet.</p>"),jt=L("<p> </p> <p> </p> <p> </p>",1),Ft=L("<p>Select a folder to validate media/scene paths.</p>"),$t=L('<p class="mt-2 rounded-[var(--radius-button)] border border-[var(--stroke)] bg-white px-2 py-1 text-xs text-slate-700"> </p>'),Lt=L('<p class="mt-2 rounded-[var(--radius-button)] border border-[var(--stroke)] bg-white px-2 py-1 text-xs text-slate-700"> </p>'),Rt=L("<li> </li>"),Nt=L('<div class="mt-2 max-h-28 overflow-y-auto rounded-[var(--radius-button)] border border-amber-200 bg-amber-50 p-2 text-xs text-amber-800"><p class="mb-1 font-normal">Missing paths</p> <ul class="mono space-y-0.5"></ul></div>'),zt=L(`<main class="mx-auto flex min-h-[100dvh] w-full max-w-6xl flex-col gap-3 px-3 py-3"><header class="tiny-shadow rounded-[var(--radius)] border border-[var(--panel-stroke)] bg-[var(--panel-fill)] px-3 py-2"><p class="mono text-[10px] uppercase tracking-[0.16em] text-slate-600">Vantage Utils</p> <h1 class="text-base font-normal text-slate-900">/process</h1> <p class="text-sm text-slate-700">Paste a <code class="mono">&lt;vantage-renderer&gt;</code> block, pick the local folder with
      assets, then generate <code class="mono">story.json</code>.</p></header> <section class="grid min-h-0 flex-1 gap-3 lg:grid-cols-2"><div class="tiny-shadow flex min-h-0 flex-col rounded-[var(--radius)] border border-[var(--panel-stroke)] bg-[var(--panel-fill)] p-2"><div class="mb-2 flex flex-wrap items-center gap-2"><label for="renderer-html-input" class="mono text-[11px] uppercase tracking-[0.14em] text-slate-700">Source HTML</label> <button type="button" class="rounded-[var(--radius-button)] border border-[var(--panel-stroke)] bg-white px-2 py-1 text-[11px] text-slate-700 hover:bg-slate-100">Clear</button></div> <textarea id="renderer-html-input" class="mono min-h-[340px] w-full flex-1 resize-y rounded-[var(--radius-button)] border border-[var(--stroke)] bg-white p-2 text-[12px] leading-relaxed text-slate-800" placeholder="Paste your &lt;vantage-renderer>...&lt;/vantage-renderer> block here"></textarea> <div class="mt-2 rounded-[var(--radius-button)] border border-[var(--stroke)] bg-white p-2"><label for="folder-input" class="block text-xs font-normal text-slate-800">Local folder (optional asset check)</label> <input id="folder-input" type="file" class="mt-1 block w-full text-xs text-slate-700" multiple webkitdirectory directory=""/> <p class="mt-1 text-xs text-slate-600"> </p></div> <p class="mt-2 text-xs text-slate-700">Scene + projection paths are rewritten to: <code class="mono"> </code></p> <div class="mt-2 flex flex-wrap gap-2"><button type="button" class="rounded-[var(--radius-button)] bg-[var(--lime)] px-3 py-1.5 text-xs font-normal text-slate-950 hover:brightness-95">Generate story.json</button></div> <!></div> <div class="tiny-shadow flex min-h-0 flex-col rounded-[var(--radius)] border border-[var(--panel-stroke)] bg-[var(--panel-fill)] p-2"><div class="mb-2 flex flex-wrap items-center gap-2"><label for="output-json-textarea" class="mono text-[11px] uppercase tracking-[0.14em] text-slate-700">Output JSON</label> <input type="text" class="mono min-w-0 flex-1 rounded-[var(--radius-button)] border border-[var(--stroke)] bg-white px-2 py-1 text-xs text-slate-800" placeholder="story.json"/> <button type="button" class="rounded-[var(--radius-button)] border border-[var(--panel-stroke)] bg-white px-2 py-1 text-[11px] text-slate-700 hover:bg-slate-100 disabled:opacity-40"> </button> <button type="button" class="rounded-[var(--radius-button)] border border-[var(--panel-stroke)] bg-white px-2 py-1 text-[11px] text-slate-700 hover:bg-slate-100 disabled:opacity-40">Download</button> <button type="button" class="rounded-[var(--radius-button)] border border-[var(--panel-stroke)] bg-white px-2 py-1 text-[11px] text-slate-700 hover:bg-slate-100 disabled:opacity-40">Save In Folder</button> <button type="button" class="rounded-[var(--radius-button)] border border-[var(--panel-stroke)] bg-white px-2 py-1 text-[11px] text-slate-700 hover:bg-slate-100 disabled:opacity-40"> </button></div> <textarea id="output-json-textarea" readonly="" class="mono min-h-[340px] w-full flex-1 resize-y rounded-[var(--radius-button)] border border-[var(--stroke)] bg-white p-2 text-[12px] leading-relaxed text-slate-800" placeholder="Generated JSON will appear here"></textarea> <div class="mt-2 grid gap-2 md:grid-cols-2"><div class="rounded-[var(--radius-button)] border border-[var(--stroke)] bg-white p-2 text-xs text-slate-700"><p class="mono mb-1 uppercase tracking-[0.12em] text-slate-500">Summary</p> <!></div> <div class="rounded-[var(--radius-button)] border border-[var(--stroke)] bg-white p-2 text-xs text-slate-700"><p class="mono mb-1 uppercase tracking-[0.12em] text-slate-500">Asset Check</p> <!></div></div> <!> <!> <!></div></section></main>`);function Ht(t,i){ut(i,!0);let h=P(""),s=P(we([])),x=P("No folder selected"),l=P(""),u=P("story.json"),c=P(""),k=P(""),S=P(!1),b=P(""),y=P(""),F=P(!1),w=P(null),g=P(null),R=P(we([])),T=P(null);const Ae=e=>{var d;const r=(d=e[0])==null?void 0:d.webkitRelativePath;if(typeof r!="string"||r.length===0)return`${e.length} file${e.length===1?"":"s"} selected`;const[o]=r.split("/");return`${o} (${e.length} files)`},je=e=>{var o;const r=(o=e[0])==null?void 0:o.webkitRelativePath;return typeof r!="string"||r.length===0?"":r.split("/")[0]??""},H=e=>e.replace(/\\+/g,"/"),le=e=>{const r=e.indexOf("#"),o=e.indexOf("?"),d=[r,o].filter(p=>p>=0).sort((p,_)=>p-_)[0];return d==null?{base:e,suffix:""}:{base:e.slice(0,d),suffix:e.slice(d)}},ce=e=>/^(https?:|data:|blob:|\/\/|file:)/i.test(e),Fe=e=>{const o=H(e).replace(/^\/+/,"").split("/").filter(Boolean);return o.length<=1?o[0]??"":o.slice(1).join("/")},$e=e=>{if(typeof e!="string")return"";const r=e.trim();if(r.length===0)return"";const{base:o}=le(r);let d=H(o);if(ce(d))try{d=new URL(d).pathname}catch{return""}return d.replace(/^\/+/,"").replace(/^\.\//,"").split("/").filter(Boolean).at(-1)??""},B=(e,r)=>{if(typeof e!="string")return e;const o=e.trim();if(o.length===0)return e;const d=$e(o);if(d.length===0)return e;const{suffix:p}=le(o);return`/data/${r}/${d}${p}`},Le=e=>{const r=new Set,o=d=>{if(typeof d!="string")return;const p=d.trim();p.length===0||ce(p)||r.add(p)};o(e.sceneSrc);for(const d of e.projections??[])o(d.src),o(d.previewSrc);return Array.from(r)},Re=e=>a(l).length===0?e:{...e,sceneSrc:B(e.sceneSrc,a(l)),projections:(e.projections??[]).map(r=>({...r,src:B(r.src,a(l)),previewSrc:B(r.previewSrc,a(l))}))},de=()=>{if(!a(T))return;const e=Re(a(T));n(c,`${JSON.stringify(e,null,2)}
`);const r=Le(e);n(R,r,!0),n(g,ie(r,a(s)),!0)},Ne=e=>{const r=Array.from(e.currentTarget.files??[]);n(s,r,!0),n(x,r.length>0?Ae(r):"No folder selected",!0),n(l,r.length>0?je(r):"",!0),n(y,""),n(b,""),a(T)?de():a(R).length>0&&n(g,ie(a(R),r),!0)},ze=()=>{n(S,!1),n(b,""),n(y,"");try{const{story:e,stats:r,assetPaths:o}=kt(a(h));n(T,e,!0),de(),n(w,r,!0),a(l).length===0&&(n(R,o,!0),n(g,ie(o,a(s)),!0)),n(k,"")}catch(e){n(c,""),n(w,null),n(g,null),n(R,[],!0),n(T,null),n(k,e instanceof Error?e.message:"Failed to process input HTML.",!0)}},Te=async()=>{if(a(c))try{await navigator.clipboard.writeText(a(c)),n(S,!0),n(b,""),n(y,"")}catch{n(S,!1)}},De=()=>{if(!a(c))return;const e=a(u).trim().length>0?a(u).trim():"story.json",r=e.endsWith(".json")?e:`${e}.json`,o=new Blob([a(c)],{type:"application/json;charset=utf-8"}),d=URL.createObjectURL(o),p=document.createElement("a");p.href=d,p.download=r,p.click(),URL.revokeObjectURL(d)},Me=async()=>{if(!(!a(c)||a(s).length===0||a(l).length===0)){n(F,!0),n(y,"");try{const e=(await at(async()=>{const{default:_}=await import("../chunks/Cd-LGQp-.js").then(N=>N.j);return{default:_}},[],import.meta.url)).default,r=new e;for(const _ of a(s)){const N=typeof _.webkitRelativePath=="string"&&_.webkitRelativePath.length>0?H(_.webkitRelativePath):`${a(l)}/${_.name}`,ye=Fe(N).split("/").filter(Boolean).at(-1);if(!ye)continue;const rt=await _.arrayBuffer();r.file(`data/${a(l)}/${ye}`,rt)}r.file(`data/${a(l)}/story.json`,a(c));const o=await r.generateAsync({type:"blob"}),d=URL.createObjectURL(o),p=document.createElement("a");p.href=d,p.download=`${a(l)}.zip`,p.click(),URL.revokeObjectURL(d),n(y,`Downloaded ${a(l)}.zip with /data/${a(l)}/story.json.`)}catch{n(y,"Could not package folder zip.")}finally{n(F,!1)}}},Oe=async()=>{if(!a(c))return;const e=a(u).trim().length>0?a(u).trim():"story.json",r=e.endsWith(".json")?e:`${e}.json`;if(typeof window>"u"||typeof window.showDirectoryPicker!="function"){n(b,"Direct folder save is not supported in this browser. Use Download.");return}try{const p=await(await(await window.showDirectoryPicker()).getFileHandle(r,{create:!0})).createWritable();await p.write(a(c)),await p.close(),n(b,`Saved ${r} to selected folder.`)}catch(o){(o==null?void 0:o.name)==="AbortError"?n(b,"Save cancelled."):n(b,"Could not save directly. Use Download.")}};var q=zt();bt("afnr3e",e=>{pt(()=>{ft.title="Process HTML to Story JSON"})});var ue=f(m(q),2),J=m(ue),W=m(J),Ie=f(m(W),2);Ie.__click=()=>{n(h,""),n(c,""),n(k,""),n(w,null),n(g,null),n(R,[],!0),n(T,null),n(y,""),n(b,"")},v(W);var Z=f(W,2);_e(Z);var G=f(Z,2),pe=f(m(G),2);pe.__change=Ne;var fe=f(pe,2),Ue=m(fe,!0);v(fe),v(G);var Q=f(G,2),ve=f(m(Q)),Ce=m(ve,!0);v(ve),v(Q);var V=f(Q,2),He=m(V);He.__click=ze,v(V);var Be=f(V,2);{var qe=e=>{var r=St(),o=m(r,!0);v(r),z(()=>j(o,a(k))),$(e,r)};D(Be,e=>{a(k)&&e(qe)})}v(J);var be=f(J,2),K=m(be),X=f(m(K),2);mt(X);var M=f(X,2);M.__click=Te;var Je=m(M,!0);v(M);var Y=f(M,2);Y.__click=De;var E=f(Y,2);E.__click=Oe;var U=f(E,2);U.__click=Me;var We=m(U,!0);v(U),v(K);var ee=f(K,2);_e(ee);var te=f(ee,2),re=m(te),Ze=f(m(re),2);{var Ge=e=>{var r=Pt(),o=ke(r),d=m(o);v(o);var p=f(o,2),_=m(p);v(p),z(()=>{j(d,`Projections: ${a(w).projections??""}`),j(_,`Keyframes: ${a(w).keyframes??""}`)}),$(e,r)},Qe=e=>{var r=At();$(e,r)};D(Ze,e=>{a(w)?e(Ge):e(Qe,!1)})}v(re);var me=f(re,2),Ve=f(m(me),2);{var Ke=e=>{var r=jt(),o=ke(r),d=m(o);v(o);var p=f(o,2),_=m(p);v(p);var N=f(p,2),xe=m(N);v(N),z(()=>{j(d,`Assets referenced: ${a(g).total??""}`),j(_,`Matched in folder: ${a(g).found.length??""}`),j(xe,`Missing: ${a(g).missing.length??""}`)}),$(e,r)},Xe=e=>{var r=Ft();$(e,r)};D(Ve,e=>{a(g)?e(Ke):e(Xe,!1)})}v(me),v(te);var he=f(te,2);{var Ye=e=>{var r=$t(),o=m(r,!0);v(r),z(()=>j(o,a(b))),$(e,r)};D(he,e=>{a(b)&&e(Ye)})}var ge=f(he,2);{var Ee=e=>{var r=Lt(),o=m(r,!0);v(r),z(()=>j(o,a(y))),$(e,r)};D(ge,e=>{a(y)&&e(Ee)})}var et=f(ge,2);{var tt=e=>{var r=Nt(),o=f(m(r),2);ht(o,20,()=>a(g).missing,d=>d,(d,p)=>{var _=Rt(),N=m(_,!0);v(_),z(()=>j(N,p)),$(d,_)}),v(o),v(r),$(e,r)};D(et,e=>{a(g)&&a(g).missing.length>0&&e(tt)})}v(be),v(ue),v(q),z(()=>{j(Ue,a(x)),j(Ce,a(l)?`/data/${a(l)}/FILENAME`:"/data/FOLDER/FILENAME"),M.disabled=!a(c),j(Je,a(S)?"Copied":"Copy"),Y.disabled=!a(c),E.disabled=!a(c),U.disabled=!a(c)||a(s).length===0||a(F),j(We,a(F)?"Packaging...":"Download Folder ZIP")}),ae(Z,()=>a(h),e=>n(h,e)),ae(X,()=>a(u),e=>n(u,e)),ae(ee,()=>a(c),e=>n(c,e)),$(t,q),dt()}vt(["click","change"]);export{Ht as component,Ct as universal};
