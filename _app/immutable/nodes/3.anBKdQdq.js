import{i as O,_ as at}from"../chunks/KL1EyAOk.js";import{a as $,f as L}from"../chunks/BNEZD2xT.js";import{Q as ot,g as nt,e as M,w as st,R as lt,h as it,T as ct,U as A,B as ye,C as n,V as N,W as dt,X as ut,A as a,v as pt,$ as ft,Y as f,Z as m,_ as v,a0 as _e,t as we}from"../chunks/BF7hPvJd.js";import{d as vt,s as j}from"../chunks/BUneq0kb.js";import{r as bt,h as mt,a as ht,e as gt}from"../chunks/B8mQ5B8w.js";function re(t,s,b=s){var l=new WeakSet;ot(t,"input",async g=>{var i=g?t.defaultValue:t.value;if(i=ae(t)?oe(i):i,b(i),M!==null&&l.add(M),await lt(),i!==(i=s())){var p=t.selectionStart,d=t.selectionEnd,y=t.value.length;if(t.value=i??"",d!==null){var _=t.value.length;p===d&&d===y&&_>y?(t.selectionStart=_,t.selectionEnd=_):(t.selectionStart=p,t.selectionEnd=Math.min(d,_))}}}),(it&&t.defaultValue!==t.value||nt(s)==null&&t.value)&&(b(ae(t)?oe(t.value):t.value),M!==null&&l.add(M)),st(()=>{var g=s();if(t===document.activeElement){var i=ct??M;if(l.has(i))return}ae(t)&&g===oe(t.value)||t.type==="date"&&!g&&!t.value||g!==t.value&&(t.value=g??"")})}function ae(t){var s=t.type;return s==="number"||s==="range"}function oe(t){return t===""?null:+t}const xt=!0,It=Object.freeze(Object.defineProperty({__proto__:null,prerender:xt},Symbol.toStringTag,{value:"Module"})),U=(t,s)=>{const b=Number(t);return Number.isFinite(b)?b:s},ke=(t,s=!1)=>{if(t===!0)return!0;if(t===!1||t==null)return s;if(typeof t=="string"){if(t==="false"||t==="0")return!1;if(t==="true"||t==="1"||t==="")return!0}return s},P=t=>typeof t!="string"?"":t.trim(),Se=(t,s="")=>{const b=P(t.getAttribute("context"));if(b.length>0)return b;const l=P(t.getAttribute("context-title")),g=P(t.getAttribute("context-text"));if(l.length>0||g.length>0)return{...l.length>0?{title:l}:{},...g.length>0?{text:g}:{}};const i=P(s);return i.length>0?i:void 0},yt=t=>{const s=t.cloneNode(!0);return s.querySelectorAll("vantage-keyframe").forEach(b=>b.remove()),s.textContent??""},ne=t=>{const s=P(t);if(s.length===0||/^(https?:|data:|blob:|\/\/|file:)/i.test(s))return null;const i=s.split("#")[0].split("?")[0].replace(/\\+/g,"/").replace(/^\.\//,"").replace(/^\/+/,"");return i.length>0?i:null},_t=t=>{const s=Array.from(t.querySelectorAll("vantage-projection")).filter(l=>l.parentElement===t);let b=0;return s.map(l=>{b+=1;const g=P(l.getAttribute("projection-type"))||"perspective",i=Array.from(l.querySelectorAll("vantage-keyframe")).filter(h=>h.parentElement===l).map(h=>{const w={time:U(h.getAttribute("time"),0)};for(const S of["position","rotation","layers","bounds"]){const x=P(h.getAttribute(S));x.length>0&&(w[S]=x)}for(const S of["fov","far","opacity"]){const x=h.getAttribute(S);x!=null&&x!==""&&(w[S]=U(x,void 0))}h.hasAttribute("screen")&&(w.screen=ke(h.getAttribute("screen"),!0));const F=Se(h,h.textContent??"");return F!=null&&(w.context=F),w}),p={id:P(l.getAttribute("id"))||`projection-${b}`,src:P(l.getAttribute("src")),projectionType:g,time:U(l.getAttribute("time"),0),cameraSelectable:l.hasAttribute("camera-selectable")?ke(l.getAttribute("camera-selectable"),!0):g!=="map",keyframes:i},d=P(l.getAttribute("label"));d.length>0&&(p.label=d);const y=P(l.getAttribute("preview-src"));y.length>0&&(p.previewSrc=y),l.hasAttribute("start-time")&&(p.startTime=U(l.getAttribute("start-time"),p.time));const _=Se(l,yt(l));return _!=null&&(p.context=_),p})},wt=t=>{const s=t.querySelector("vantage-renderer");if(s)return{renderer:s,sceneSrc:P(s.getAttribute("scene"))||""};if(!t.querySelector("vantage-projection"))throw new Error("No <vantage-renderer> or <vantage-projection> found in the pasted HTML.");return{renderer:t.body,sceneSrc:""}},kt=t=>{if(typeof DOMParser>"u")throw new Error("DOMParser is not available in this environment.");const s=P(t);if(s.length===0)throw new Error("Paste the <vantage-renderer> block first.");const l=new DOMParser().parseFromString(s,"text/html"),{renderer:g,sceneSrc:i}=wt(l),p=l.querySelector("input#time"),d={sceneSrc:i,maxTimelineTime:U(p==null?void 0:p.getAttribute("max"),void 0),projections:_t(g)},y=bt(d),_={sceneSrc:y.sceneSrc,maxTimelineTime:y.maxTimelineTime,ui:y.ui,projections:y.projections},h=new Set,w=ne(_.sceneSrc);w&&h.add(w);for(const F of _.projections){const S=ne(F.src);S&&h.add(S);const x=ne(F.previewSrc);x&&h.add(x)}return{story:_,stats:{projections:_.projections.length,keyframes:_.projections.reduce((F,S)=>F+S.keyframes.length,0)},assetPaths:Array.from(h)}},Ae=t=>{const s=P(t).replace(/\\+/g,"/").replace(/^\/+/,"");return s.length===0?"":s.split("/").filter(Boolean).at(-1)??""},se=(t,s)=>{const b=Array.isArray(s)?s:[];if(b.length===0)return{total:t.length,checked:0,found:[],missing:[]};const l=new Set;for(const p of b){const d=typeof p.webkitRelativePath=="string"&&p.webkitRelativePath.length>0?p.webkitRelativePath:p.name,y=Ae(d);y.length>0&&l.add(y)}const g=[],i=[];for(const p of t){const d=Ae(p);l.has(d)?g.push(p):i.push(p)}return{total:t.length,checked:b.length,found:g,missing:i}};var St=L('<p class="mt-2 rounded-[var(--radius-button)] border border-red-200 bg-red-50 px-2 py-1 text-xs text-red-700"> </p>'),At=L("<p> </p> <p> </p>",1),Pt=L("<p>No data yet.</p>"),jt=L("<p> </p> <p> </p> <p> </p>",1),Ft=L("<p>Select a folder to validate media/scene paths.</p>"),$t=L('<p class="mt-2 rounded-[var(--radius-button)] border border-[var(--stroke)] bg-white px-2 py-1 text-xs text-slate-700"> </p>'),Lt=L('<p class="mt-2 rounded-[var(--radius-button)] border border-[var(--stroke)] bg-white px-2 py-1 text-xs text-slate-700"> </p>'),Rt=L("<li> </li>"),Nt=L('<div class="mt-2 max-h-28 overflow-y-auto rounded-[var(--radius-button)] border border-amber-200 bg-amber-50 p-2 text-xs text-amber-800"><p class="mb-1 font-medium">Missing paths</p> <ul class="mono space-y-0.5"></ul></div>'),Tt=L(`<main class="mx-auto flex min-h-[100dvh] w-full max-w-6xl flex-col gap-3 px-3 py-3"><header class="tiny-shadow rounded-[var(--radius)] border border-[var(--panel-stroke)] bg-[var(--panel-fill)] px-3 py-2"><p class="mono text-[10px] uppercase tracking-[0.16em] text-slate-600">Vantage Utils</p> <h1 class="text-base font-semibold text-slate-900">/process</h1> <p class="text-sm text-slate-700">Paste a <code class="mono">&lt;vantage-renderer&gt;</code> block, pick the local folder with
      assets, then generate <code class="mono">story.json</code>.</p></header> <section class="grid min-h-0 flex-1 gap-3 lg:grid-cols-2"><div class="tiny-shadow flex min-h-0 flex-col rounded-[var(--radius)] border border-[var(--panel-stroke)] bg-[var(--panel-fill)] p-2"><div class="mb-2 flex flex-wrap items-center gap-2"><label for="renderer-html-input" class="mono text-[11px] uppercase tracking-[0.14em] text-slate-700">Source HTML</label> <button type="button" class="rounded-[var(--radius-button)] border border-[var(--panel-stroke)] bg-white px-2 py-1 text-[11px] text-slate-700 hover:bg-slate-100">Clear</button></div> <textarea id="renderer-html-input" class="mono min-h-[340px] w-full flex-1 resize-y rounded-[var(--radius-button)] border border-[var(--stroke)] bg-white p-2 text-[12px] leading-relaxed text-slate-800" placeholder="Paste your &lt;vantage-renderer>...&lt;/vantage-renderer> block here"></textarea> <div class="mt-2 rounded-[var(--radius-button)] border border-[var(--stroke)] bg-white p-2"><label for="folder-input" class="block text-xs font-medium text-slate-800">Local folder (optional asset check)</label> <input id="folder-input" type="file" class="mt-1 block w-full text-xs text-slate-700" multiple webkitdirectory directory=""/> <p class="mt-1 text-xs text-slate-600"> </p></div> <p class="mt-2 text-xs text-slate-700">Scene + projection paths are rewritten to: <code class="mono"> </code></p> <div class="mt-2 flex flex-wrap gap-2"><button type="button" class="rounded-[var(--radius-button)] bg-[var(--lime)] px-3 py-1.5 text-xs font-semibold text-slate-950 hover:brightness-95">Generate story.json</button></div> <!></div> <div class="tiny-shadow flex min-h-0 flex-col rounded-[var(--radius)] border border-[var(--panel-stroke)] bg-[var(--panel-fill)] p-2"><div class="mb-2 flex flex-wrap items-center gap-2"><label for="output-json-textarea" class="mono text-[11px] uppercase tracking-[0.14em] text-slate-700">Output JSON</label> <input type="text" class="mono min-w-0 flex-1 rounded-[var(--radius-button)] border border-[var(--stroke)] bg-white px-2 py-1 text-xs text-slate-800" placeholder="story.json"/> <button type="button" class="rounded-[var(--radius-button)] border border-[var(--panel-stroke)] bg-white px-2 py-1 text-[11px] text-slate-700 hover:bg-slate-100 disabled:opacity-40"> </button> <button type="button" class="rounded-[var(--radius-button)] border border-[var(--panel-stroke)] bg-white px-2 py-1 text-[11px] text-slate-700 hover:bg-slate-100 disabled:opacity-40">Download</button> <button type="button" class="rounded-[var(--radius-button)] border border-[var(--panel-stroke)] bg-white px-2 py-1 text-[11px] text-slate-700 hover:bg-slate-100 disabled:opacity-40">Save In Folder</button> <button type="button" class="rounded-[var(--radius-button)] border border-[var(--panel-stroke)] bg-white px-2 py-1 text-[11px] text-slate-700 hover:bg-slate-100 disabled:opacity-40"> </button></div> <textarea id="output-json-textarea" readonly="" class="mono min-h-[340px] w-full flex-1 resize-y rounded-[var(--radius-button)] border border-[var(--stroke)] bg-white p-2 text-[12px] leading-relaxed text-slate-800" placeholder="Generated JSON will appear here"></textarea> <div class="mt-2 grid gap-2 md:grid-cols-2"><div class="rounded-[var(--radius-button)] border border-[var(--stroke)] bg-white p-2 text-xs text-slate-700"><p class="mono mb-1 uppercase tracking-[0.12em] text-slate-500">Summary</p> <!></div> <div class="rounded-[var(--radius-button)] border border-[var(--stroke)] bg-white p-2 text-xs text-slate-700"><p class="mono mb-1 uppercase tracking-[0.12em] text-slate-500">Asset Check</p> <!></div></div> <!> <!> <!></div></section></main>`);function Ct(t,s){ut(s,!0);let b=A(""),l=A(ye([])),g=A("No folder selected"),i=A(""),p=A("story.json"),d=A(""),y=A(""),_=A(!1),h=A(""),w=A(""),F=A(!1),S=A(null),x=A(null),T=A(ye([])),z=A(null);const Pe=e=>{var c;const r=(c=e[0])==null?void 0:c.webkitRelativePath;if(typeof r!="string"||r.length===0)return`${e.length} file${e.length===1?"":"s"} selected`;const[o]=r.split("/");return`${o} (${e.length} files)`},je=e=>{var o;const r=(o=e[0])==null?void 0:o.webkitRelativePath;return typeof r!="string"||r.length===0?"":r.split("/")[0]??""},C=e=>e.replace(/\\+/g,"/"),le=e=>{const r=e.indexOf("#"),o=e.indexOf("?"),c=[r,o].filter(u=>u>=0).sort((u,k)=>u-k)[0];return c==null?{base:e,suffix:""}:{base:e.slice(0,c),suffix:e.slice(c)}},ie=e=>/^(https?:|data:|blob:|\/\/|file:)/i.test(e),Fe=e=>{const o=C(e).replace(/^\/+/,"").split("/").filter(Boolean);return o.length<=1?o[0]??"":o.slice(1).join("/")},$e=e=>{if(typeof e!="string")return"";const r=e.trim();if(r.length===0)return"";const{base:o}=le(r);let c=C(o);if(ie(c))try{c=new URL(c).pathname}catch{return""}return c.replace(/^\/+/,"").replace(/^\.\//,"").split("/").filter(Boolean).at(-1)??""},H=(e,r)=>{if(typeof e!="string")return e;const o=e.trim();if(o.length===0)return e;const c=$e(o);if(c.length===0)return e;const{suffix:u}=le(o);return`/data/${r}/${c}${u}`},Le=e=>{const r=new Set,o=c=>{if(typeof c!="string")return;const u=c.trim();u.length===0||ie(u)||r.add(u)};o(e.sceneSrc);for(const c of e.projections??[])o(c.src),o(c.previewSrc);return Array.from(r)},Re=e=>a(i).length===0?e:{...e,sceneSrc:H(e.sceneSrc,a(i)),projections:(e.projections??[]).map(r=>({...r,src:H(r.src,a(i)),previewSrc:H(r.previewSrc,a(i))}))},ce=()=>{if(!a(z))return;const e=Re(a(z));n(d,`${JSON.stringify(e,null,2)}
`);const r=Le(e);n(T,r,!0),n(x,se(r,a(l)),!0)},Ne=e=>{const r=Array.from(e.currentTarget.files??[]);n(l,r,!0),n(g,r.length>0?Pe(r):"No folder selected",!0),n(i,r.length>0?je(r):"",!0),n(w,""),n(h,""),a(z)?ce():a(T).length>0&&n(x,se(a(T),r),!0)},Te=()=>{n(_,!1),n(h,""),n(w,"");try{const{story:e,stats:r,assetPaths:o}=kt(a(b));n(z,e,!0),ce(),n(S,r,!0),a(i).length===0&&(n(T,o,!0),n(x,se(o,a(l)),!0)),n(y,"")}catch(e){n(d,""),n(S,null),n(x,null),n(T,[],!0),n(z,null),n(y,e instanceof Error?e.message:"Failed to process input HTML.",!0)}},ze=async()=>{if(a(d))try{await navigator.clipboard.writeText(a(d)),n(_,!0),n(h,""),n(w,"")}catch{n(_,!1)}},Oe=()=>{if(!a(d))return;const e=a(p).trim().length>0?a(p).trim():"story.json",r=e.endsWith(".json")?e:`${e}.json`,o=new Blob([a(d)],{type:"application/json;charset=utf-8"}),c=URL.createObjectURL(o),u=document.createElement("a");u.href=c,u.download=r,u.click(),URL.revokeObjectURL(c)},De=async()=>{if(!(!a(d)||a(l).length===0||a(i).length===0)){n(F,!0),n(w,"");try{const e=(await at(async()=>{const{default:k}=await import("../chunks/Cd-LGQp-.js").then(R=>R.j);return{default:k}},[],import.meta.url)).default,r=new e;for(const k of a(l)){const R=typeof k.webkitRelativePath=="string"&&k.webkitRelativePath.length>0?C(k.webkitRelativePath):`${a(i)}/${k.name}`,xe=Fe(R).split("/").filter(Boolean).at(-1);if(!xe)continue;const rt=await k.arrayBuffer();r.file(`data/${a(i)}/${xe}`,rt)}r.file(`data/${a(i)}/story.json`,a(d));const o=await r.generateAsync({type:"blob"}),c=URL.createObjectURL(o),u=document.createElement("a");u.href=c,u.download=`${a(i)}.zip`,u.click(),URL.revokeObjectURL(c),n(w,`Downloaded ${a(i)}.zip with /data/${a(i)}/story.json.`)}catch{n(w,"Could not package folder zip.")}finally{n(F,!1)}}},Me=async()=>{if(!a(d))return;const e=a(p).trim().length>0?a(p).trim():"story.json",r=e.endsWith(".json")?e:`${e}.json`;if(typeof window>"u"||typeof window.showDirectoryPicker!="function"){n(h,"Direct folder save is not supported in this browser. Use Download.");return}try{const u=await(await(await window.showDirectoryPicker()).getFileHandle(r,{create:!0})).createWritable();await u.write(a(d)),await u.close(),n(h,`Saved ${r} to selected folder.`)}catch(o){(o==null?void 0:o.name)==="AbortError"?n(h,"Save cancelled."):n(h,"Could not save directly. Use Download.")}};var B=Tt();mt("afnr3e",e=>{pt(()=>{ft.title="Process HTML to Story JSON"})});var de=f(m(B),2),J=m(de),q=m(J),Ue=f(m(q),2);Ue.__click=()=>{n(b,""),n(d,""),n(y,""),n(S,null),n(x,null),n(T,[],!0),n(z,null),n(w,""),n(h,"")},v(q);var W=f(q,2);_e(W);var Z=f(W,2),ue=f(m(Z),2);ue.__change=Ne;var pe=f(ue,2),Ie=m(pe,!0);v(pe),v(Z);var E=f(Z,2),fe=f(m(E)),Ce=m(fe,!0);v(fe),v(E);var Q=f(E,2),He=m(Q);He.__click=Te,v(Q);var Be=f(Q,2);{var Je=e=>{var r=St(),o=m(r,!0);v(r),N(()=>j(o,a(y))),$(e,r)};O(Be,e=>{a(y)&&e(Je)})}v(J);var ve=f(J,2),V=m(ve),G=f(m(V),2);ht(G);var D=f(G,2);D.__click=ze;var qe=m(D,!0);v(D);var K=f(D,2);K.__click=Oe;var X=f(K,2);X.__click=Me;var I=f(X,2);I.__click=De;var We=m(I,!0);v(I),v(V);var Y=f(V,2);_e(Y);var ee=f(Y,2),te=m(ee),Ze=f(m(te),2);{var Ee=e=>{var r=At(),o=we(r),c=m(o);v(o);var u=f(o,2),k=m(u);v(u),N(()=>{j(c,`Projections: ${a(S).projections??""}`),j(k,`Keyframes: ${a(S).keyframes??""}`)}),$(e,r)},Qe=e=>{var r=Pt();$(e,r)};O(Ze,e=>{a(S)?e(Ee):e(Qe,!1)})}v(te);var be=f(te,2),Ve=f(m(be),2);{var Ge=e=>{var r=jt(),o=we(r),c=m(o);v(o);var u=f(o,2),k=m(u);v(u);var R=f(u,2),ge=m(R);v(R),N(()=>{j(c,`Assets referenced: ${a(x).total??""}`),j(k,`Matched in folder: ${a(x).found.length??""}`),j(ge,`Missing: ${a(x).missing.length??""}`)}),$(e,r)},Ke=e=>{var r=Ft();$(e,r)};O(Ve,e=>{a(x)?e(Ge):e(Ke,!1)})}v(be),v(ee);var me=f(ee,2);{var Xe=e=>{var r=$t(),o=m(r,!0);v(r),N(()=>j(o,a(h))),$(e,r)};O(me,e=>{a(h)&&e(Xe)})}var he=f(me,2);{var Ye=e=>{var r=Lt(),o=m(r,!0);v(r),N(()=>j(o,a(w))),$(e,r)};O(he,e=>{a(w)&&e(Ye)})}var et=f(he,2);{var tt=e=>{var r=Nt(),o=f(m(r),2);gt(o,20,()=>a(x).missing,c=>c,(c,u)=>{var k=Rt(),R=m(k,!0);v(k),N(()=>j(R,u)),$(c,k)}),v(o),v(r),$(e,r)};O(et,e=>{a(x)&&a(x).missing.length>0&&e(tt)})}v(ve),v(de),v(B),N(()=>{j(Ie,a(g)),j(Ce,a(i)?`/data/${a(i)}/FILENAME`:"/data/FOLDER/FILENAME"),D.disabled=!a(d),j(qe,a(_)?"Copied":"Copy"),K.disabled=!a(d),X.disabled=!a(d),I.disabled=!a(d)||a(l).length===0||a(F),j(We,a(F)?"Packaging...":"Download Folder ZIP")}),re(W,()=>a(b),e=>n(b,e)),re(G,()=>a(p),e=>n(p,e)),re(Y,()=>a(d),e=>n(d,e)),$(t,B),dt()}vt(["click","change"]);export{Ct as component,It as universal};
