import{c as V,i as ce,h as _,o as D,j as Te,A as te,k as ye,H as Ee,n as se,q as k,a as F,a1 as ue,a2 as Se,a3 as ie,a4 as E,b as P,a5 as be,a6 as de,K as Ae,a7 as xe,a8 as J,r as ve,p as me,e as Ne,s as we,a9 as B,aa as ke,ab as Me,ac as Ce,ad as ne,ae as Ie,af as Le,d as Oe,ag as Re,x as pe,ah as Y,ai as _e,aj as Fe,ak as He,al as fe,am as le,an as De,ao as ze,ap as Ue,aq as Ve,ar as qe,as as Be,M as Pe}from"./BF7hPvJd.js";function Ye(e,r,a){for(var n=[],s=r.length,i,f=r.length,d=0;d<s;d++){let T=r[d];me(T,()=>{if(i){if(i.pending.delete(T),i.done.add(T),i.pending.size===0){var u=e.outrogroups;G(J(i.done)),u.delete(i),u.size===0&&(e.outrogroups=null)}}else f-=1},!1)}if(f===0){var c=n.length===0&&a!==null;if(c){var v=a,l=v.parentNode;Le(l),l.append(v),e.items.clear()}G(r,!c)}else i={pending:new Set(r),done:new Set},(e.outrogroups??(e.outrogroups=new Set)).add(i)}function G(e,r=!0){for(var a=0;a<e.length;a++)Oe(e[a],r)}var oe;function je(e,r,a,n,s,i=null){var f=e,d=new Map,c=(r&_e)!==0;if(c){var v=e;f=_?D(de(v)):v.appendChild(V())}_&&Te();var l=null,T=Ae(()=>{var o=a();return xe(o)?o:o==null?[]:J(o)}),u,m=!0;function b(){t.fallback=l,Ge(t,u,f,r,n),l!==null&&(u.length===0?l.f&E?(l.f^=E,H(l,null,f)):ve(l):me(l,()=>{l=null}))}var M=ce(()=>{u=te(T);var o=u.length;let C=!1;if(_){var I=ye(f)===Ee;I!==(o===0)&&(f=se(),D(f),k(!1),C=!0)}for(var g=new Set,A=Ne,L=we(),p=0;p<o;p+=1){_&&F.nodeType===ue&&F.data===Se&&(f=F,C=!0,k(!1));var x=u[p],O=n(x,p),h=m?null:d.get(O);h?(h.v&&ie(h.v,x),h.i&&ie(h.i,p),L&&A.unskip_effect(h.e)):(h=Ke(d,m?f:oe??(oe=V()),x,O,p,s,r,a),m||(h.e.f|=E),d.set(O,h)),g.add(O)}if(o===0&&i&&!l&&(m?l=P(()=>i(f)):(l=P(()=>i(oe??(oe=V()))),l.f|=E)),o>g.size&&be(),_&&o>0&&D(se()),!m)if(L){for(const[z,U]of d)g.has(z)||A.skip_effect(U.e);A.oncommit(b),A.ondiscard(()=>{})}else b();C&&k(!0),te(T)}),t={effect:M,flags:r,items:d,outrogroups:null,fallback:l};m=!1,_&&(f=F)}function R(e){for(;e!==null&&!(e.f&Re);)e=e.next;return e}function Ge(e,r,a,n,s){var h,z,U,Q,W,Z,j,ee,re;var i=(n&Fe)!==0,f=r.length,d=e.items,c=R(e.effect.first),v,l=null,T,u=[],m=[],b,M,t,o;if(i)for(o=0;o<f;o+=1)b=r[o],M=s(b,o),t=d.get(M).e,t.f&E||((z=(h=t.nodes)==null?void 0:h.a)==null||z.measure(),(T??(T=new Set)).add(t));for(o=0;o<f;o+=1){if(b=r[o],M=s(b,o),t=d.get(M).e,e.outrogroups!==null)for(const y of e.outrogroups)y.pending.delete(t),y.done.delete(t);if(t.f&E)if(t.f^=E,t===c)H(t,null,a);else{var C=l?l.next:c;t===e.effect.last&&(e.effect.last=t.prev),t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),S(e,l,t),S(e,t,C),H(t,C,a),l=t,u=[],m=[],c=R(l.next);continue}if(t.f&B&&(ve(t),i&&((Q=(U=t.nodes)==null?void 0:U.a)==null||Q.unfix(),(T??(T=new Set)).delete(t))),t!==c){if(v!==void 0&&v.has(t)){if(u.length<m.length){var I=m[0],g;l=I.prev;var A=u[0],L=u[u.length-1];for(g=0;g<u.length;g+=1)H(u[g],I,a);for(g=0;g<m.length;g+=1)v.delete(m[g]);S(e,A.prev,L.next),S(e,l,A),S(e,L,I),c=I,l=L,o-=1,u=[],m=[]}else v.delete(t),H(t,c,a),S(e,t.prev,t.next),S(e,t,l===null?e.effect.first:l.next),S(e,l,t),l=t;continue}for(u=[],m=[];c!==null&&c!==t;)(v??(v=new Set)).add(c),m.push(c),c=R(c.next);if(c===null)continue}t.f&E||u.push(t),l=t,c=R(t.next)}if(e.outrogroups!==null){for(const y of e.outrogroups)y.pending.size===0&&(G(J(y.done)),(W=e.outrogroups)==null||W.delete(y));e.outrogroups.size===0&&(e.outrogroups=null)}if(c!==null||v!==void 0){var p=[];if(v!==void 0)for(t of v)t.f&B||p.push(t);for(;c!==null;)!(c.f&B)&&c!==e.fallback&&p.push(c),c=R(c.next);var x=p.length;if(x>0){var O=n&_e&&f===0?a:null;if(i){for(o=0;o<x;o+=1)(j=(Z=p[o].nodes)==null?void 0:Z.a)==null||j.measure();for(o=0;o<x;o+=1)(re=(ee=p[o].nodes)==null?void 0:ee.a)==null||re.fix()}Ye(e,p,O)}}i&&pe(()=>{var y,ae;if(T!==void 0)for(t of T)(ae=(y=t.nodes)==null?void 0:y.a)==null||ae.apply()})}function Ke(e,r,a,n,s,i,f,d){var c=f&ke?f&Me?ne(a):Ce(a,!1,!1):null,v=f&Ie?ne(s):null;return{v:c,i:v,e:P(()=>(i(r,c??a,v??s,d),()=>{e.delete(n)}))}}function H(e,r,a){if(e.nodes)for(var n=e.nodes.start,s=e.nodes.end,i=r&&!(r.f&E)?r.nodes.start:a;n!==null;){var f=Y(n);if(i.before(n),n===s)return;n=f}}function S(e,r,a){r===null?e.effect.first=a:r.next=a,a===null?e.effect.last=r:a.prev=r}function er(e,r){let a=null,n=_;var s;if(_){a=F;for(var i=de(document.head);i!==null&&(i.nodeType!==ue||i.data!==e);)i=Y(i);if(i===null)k(!1);else{var f=Y(i);i.remove(),D(f)}}_||(s=document.head.appendChild(V()));try{ce(()=>r(s),He)}finally{n&&(k(!0),D(a))}}const $e=Symbol("is custom element"),Xe=Symbol("is html");function rr(e){if(_){var r=!1,a=()=>{if(!r){if(r=!0,e.hasAttribute("value")){var n=e.value;K(e,"value",null),e.value=n}if(e.hasAttribute("checked")){var s=e.checked;K(e,"checked",null),e.checked=s}}};e.__on_r=a,pe(a),qe()}}function ar(e,r){var a=ge(e);a.value===(a.value=r??void 0)||e.value===r&&(r!==0||e.nodeName!=="PROGRESS")||(e.value=r??"")}function K(e,r,a,n){var s=ge(e);_&&(s[r]=e.getAttribute(r),r==="src"||r==="srcset"||r==="href"&&e.nodeName==="LINK")||s[r]!==(s[r]=a)&&(r==="loading"&&(e[ze]=a),a==null?e.removeAttribute(r):typeof a!="string"&&he(e).includes(r)?e[r]=a:e.setAttribute(r,a))}function tr(e,r,a){var n=Be,s=Pe;let i=_;_&&k(!1),fe(null),le(null);try{r!=="style"&&($.has(e.getAttribute("is")||e.nodeName)||!customElements||customElements.get(e.getAttribute("is")||e.tagName.toLowerCase())?he(e).includes(r):a&&typeof a=="object")?e[r]=a:K(e,r,a==null?a:String(a))}finally{fe(n),le(s),i&&k(!0)}}function ge(e){return e.__attributes??(e.__attributes={[$e]:e.nodeName.includes("-"),[Xe]:e.namespaceURI===Ue})}var $=new Map;function he(e){var r=e.getAttribute("is")||e.nodeName,a=$.get(r);if(a)return a;$.set(r,a=[]);for(var n,s=e,i=Element.prototype;i!==s;){n=Ve(s);for(var f in n)n[f].set&&a.push(f);s=De(s)}return a}const q=(e,r=0)=>{const a=Number(e);return Number.isFinite(a)?a:r},N={pageTitle:"Vantage Story",header:{title:"Vantage Story",description:""},context:{introText:"",emptyText:"No context for this keyframe."},renderer:{loading:"Loading renderer"},credits:{symbol:"Â©",label:"OpenStreetMap contributors",href:"https://www.openstreetmap.org/copyright"}},X=e=>typeof e=="string"?e.trim():"",w=(e,r)=>{const a=X(e);return a.length>0?a:r},Je=e=>{const r=e&&typeof e=="object"?e:{},a=d=>d&&typeof d=="object"?d:{},n=a(r.header),s=a(r.context),i=a(r.renderer),f=a(r.credits);return{pageTitle:w(r.pageTitle,N.pageTitle),header:{title:w(n.title,N.header.title),description:X(n.description)},context:{introText:X(s.introText),emptyText:w(s.emptyText,N.context.emptyText)},renderer:{loading:w(i.loading,N.renderer.loading)},credits:{symbol:w(f.symbol,N.credits.symbol),label:w(f.label,N.credits.label),href:w(f.href,N.credits.href)}}},Qe=(e,r)=>{const a=e.id??`projection-${r+1}`,n=q(e.time,0),s=q(e.startTime,n);return{...e,id:a,label:e.label??a,src:e.src??"",previewSrc:e.previewSrc??e.src??"",projectionType:e.projectionType??"perspective",time:n,startTime:s,cameraSelectable:e.cameraSelectable!==!1,keyframes:Array.isArray(e.keyframes)?e.keyframes:[]}},We=e=>{const r=e.flatMap(a=>{const n=a.keyframes.map(s=>q(s.time,0)+a.time);return[a.startTime,a.time,...n]});return Math.max(0,...r)},sr=(e="")=>/\.(mp4|webm|ogg)(\?.*)?$/i.test(e),ir=(e={})=>{const r=(Array.isArray(e.projections)?e.projections:[]).map(Qe),a=r.filter(s=>s.cameraSelectable).sort((s,i)=>s.startTime-i.startTime),n=We(r);return{sceneSrc:e.sceneSrc??"",maxTimelineTime:q(e.maxTimelineTime,n),projections:r,cameraTracks:a,ui:Je(e.ui)}};export{rr as a,ar as b,tr as c,je as e,er as h,sr as i,ir as r,K as s};
